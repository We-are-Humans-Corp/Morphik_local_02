version: '3.8'

services:
  # Локальный API для разработки
  morphik-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: morphik-api-dev
    ports:
      - "${LOCAL_API_PORT:-8001}:8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      - ENVIRONMENT=development
      - DEBUG=true
    volumes:
      - ./core:/app/core
      - ./storage:/app/storage
    command: >
      sh -c "
        uvicorn core.api:app --host 0.0.0.0 --port 8000 --reload
      "
    networks:
      - morphik-dev

  # Локальный UI для разработки (опционально, можно запускать через npm)
  ui-dev:
    build:
      context: ./ee/ui-component
      dockerfile: Dockerfile
    container_name: morphik-ui-dev
    ports:
      - "${LOCAL_UI_PORT:-3001}:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:${LOCAL_API_PORT:-8001}
      - NODE_ENV=development
    volumes:
      - ./ee/ui-component:/app
      - /app/node_modules
      - /app/.next
    command: npm run dev
    networks:
      - morphik-dev

networks:
  morphik-dev:
    driver: bridge